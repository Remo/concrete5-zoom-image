jQuery.fn.fancyZoom=function(j){j=j||{};var g=j&&j.directory?j.directory:"images";var b=false;if($("#zoom").length===0){var c=(("browser" in $)&&$.browser.msie)?"gif":"png";$("body").append(['<div id="zoom" style="display:none; position: relative; z-index: 900;">','<table id="zoom_table" style="border-collapse:collapse; width:100%; height:100%;">',"<tbody>","<tr>",'<td class="tl" style="background:url('+g+"/tl."+c+') 0 0 no-repeat; width:20px; height:20px; overflow:hidden;" />','<td class="tm" style="background:url('+g+"/tm."+c+') 0 0 repeat-x; height:20px; overflow:hidden;" />','<td class="tr" style="background:url('+g+"/tr."+c+') 100% 0 no-repeat; width:20px; height:20px; overflow:hidden;" />',"</tr>","<tr>",'<td class="ml" style="background:url('+g+"/ml."+c+') 0 0 repeat-y; width:20px; overflow:hidden;" />','<td class="mm" style="background:#fff; vertical-align:top; padding:10px;">','<div id="zoom_content">',"</div>","</td>",'<td class="mr" style="background:url('+g+"/mr."+c+') 100% 0 repeat-y; width:20px; overflow:hidden;" />',"</tr>","<tr>",'<td class="bl" style="background:url('+g+"/bl."+c+') 0 100% no-repeat; width:20px; height:20px; overflow:hidden;" />','<td class="bm" style="background:url('+g+"/bm."+c+') 0 100% repeat-x; height:20px; overflow:hidden;" />','<td class="br" style="background:url('+g+"/br."+c+') 100% 100% no-repeat; width:20px; height:20px; overflow:hidden;" />',"</tr>","</tbody>","</table>",'<a href="#" title="Close" id="zoom_close" style="position:absolute; top:0; left:0;">','<img src="'+g+"/closebox."+c+'" alt="Close" style="border:none; margin:0; padding:0;" />',"</a>","</div>",""].join(""));$("html").click(function(k){if($(k.target).parents("#zoom:visible").length===0){f()}});$(document).keyup(function(k){if(k.keyCode==27&&$("#zoom:visible").length>0){f()}});$("#zoom_close").click(f)}var d=$("#zoom_close");var e=$("#zoom_content");var i=null;this.each(function(){$($(this).attr("href")).hide();$(this).click(h)});return this;function h(o){if(b){return false}i=$(this);b=true;var k=$(i.attr("href"));var v={width:window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth),height:window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight),x:window.pageXOffset||(window.document.documentElement.scrollLeft||window.document.body.scrollLeft),y:window.pageYOffset||(window.document.documentElement.scrollTop||window.document.body.scrollTop)};var l=(j.width||k.width())+60;var u=(j.height||k.height())+60;if(i.data("limit-max-zoom")==="yes"){var s=Math.max(70,Math.min(l,v.width-60));var t=Math.max(70,Math.min(u,v.height-60));if((l>s)||(u>t)){var p=l/u;if(p>(s/t)){l=s;u=Math.ceil(l/p)}else{u=t;l=Math.ceil(p*t)}}}var q=Math.max((v.height/2)-(u/2)+v.y,0);var r=(v.width/2)-(l/2);var m=o.pageY;var n=o.pageX;d.attr("curTop",m);d.attr("curLeft",n);d.attr("scaleImg",j.scaleImg?"true":"false");$("#zoom").hide().css({position:"absolute",top:m+"px",left:n+"px",width:"1px",height:"1px"});d.hide();if(j.closeOnClick){$("#zoom").click(f)}if(j.scaleImg){e.html(k.html());$("#zoom_content img").css("width","100%")}else{e.html("")}$("#zoom").animate({top:q+"px",left:r+"px",opacity:"show",width:l,height:u},500,null,function(){if(j.scaleImg!=true){e.html(k.html())}d.show();b=false});if(i.data("hide-original-on-zoom")==="yes"){i.data("fancyzoom.initial-visibility",i.css("visibility"));i.css("visibility","hidden")}return false}function f(){if(b){return false}b=true;$("#zoom").unbind("click");if(d.attr("scaleImg")!="true"){e.html("")}d.hide();$("#zoom").animate({top:d.attr("curTop")+"px",left:d.attr("curLeft")+"px",opacity:"hide",width:"1px",height:"1px"},500,null,function(){if(d.attr("scaleImg")=="true"){e.html("")}b=false;if(i.data("hide-original-on-zoom")==="yes"){i.css("visibility",i.data("fancyzoom.initial-visibility"));i.data("fancyzoom.initial-visibility",null)}});return false}function a(m){$("#zoom_table td").each(function(){var n=$(this).css("background-image").replace(/\.(png|gif|none)\"\)$/,"."+m+'")');$(this).css("background-image",n)});var l=d.children("img");var k=l.attr("src").replace(/\.(png|gif|none)$/,"."+m);l.attr("src",k)}};